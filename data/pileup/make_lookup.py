data = {}
mc = {}
mc['2017'] = [3.39719372278e-05 , 7.09404093868e-06 , 1.33055464175e-05 , 3.24598549923e-05 , 5.72867356823e-05 , 9.04581174836e-05 ,
           0.000128294472233 , 0.000133290333906 , 0.000354661111487 , 0.000365025829524 , 0.000748454185668 , 0.00131064152811 ,
           0.00239722453989 , 0.00396015681326 , 0.00604592775926 , 0.00867346674204 , 0.0117365913466 , 0.0150408064947 ,
           0.0181213282049 , 0.0210592914373 , 0.0236411113292 , 0.0253431461751 , 0.0264689903706 , 0.0274818129838 ,
           0.0286782942712 , 0.0296122319996 , 0.0304959956557 , 0.0311743561178 , 0.0310999844223 , 0.0312614291906 ,
           0.0309693068266 , 0.0311890076846 , 0.0313009992242 , 0.0311588943005 , 0.0307730678469 , 0.0301437042654 ,
           0.0290457569063 , 0.0274067521095 , 0.0264933928847 , 0.0255935695022 , 0.0236029941589 , 0.0216860994697 ,
           0.0194945037365 , 0.0176285468042 , 0.0161909107119 , 0.0145961921662 , 0.0133738936856 , 0.0128812640905 ,
           0.0122986631468 , 0.0123550407588 , 0.0121635487303 , 0.0122592775151 , 0.0122174331918 , 0.012256577611 ,
           0.0122623872012 , 0.0122849131003 , 0.0121013503522 , 0.0119579220191 , 0.0115316165611 , 0.0105387317017 ,
           0.0093677630648 , 0.00806157849729 , 0.00658059539273 , 0.00522938510403 , 0.00403735646978 , 0.00350053654984 ,
           0.00294051785022 , 0.00213980441913 , 0.00150587945245 , 0.00104267522693 , 0.000709258776624 , 0.000471159350127 ,
           0.000314775970764 , 0.000203195770155 , 0.000186685458175 , 0.000140996155096 , 8.26834366308e-05 , 5.38383137609e-05 ,
           3.7845748011e-05 , 2.21872105612e-05 , 1.26588029161e-05 , 1.24309244711e-05 , 7.63092975831e-06 , 5.12305587108e-06 ,
           3.26505528392e-06 , 1.78824575414e-06 , 9.68385052147e-07 , 2.10482403418e-06 , 1.34407571295e-06 , 0.0 ,
           2.53864385513e-07 , 3.06239684278e-07 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 ,
              0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0, 0.0]

data['2017'] = [6.664595e-06, 2.572349e-05, 4.980694e-05, 9.069392e-05, 1.007774e-04, 1.453939e-04, 1.559755e-04, 1.670923e-04,
             2.314655e-04, 5.537831e-04, 1.100383e-03, 2.080586e-03, 3.283531e-03, 4.718383e-03, 6.682845e-03, 9.411571e-03,
             1.307260e-02, 1.728344e-02, 2.142947e-02, 2.526246e-02, 2.862496e-02, 3.133638e-02, 3.341586e-02, 3.503546e-02,
             3.643260e-02, 3.774157e-02, 3.882533e-02, 3.945822e-02, 3.949982e-02, 3.891851e-02, 3.778724e-02, 3.621496e-02,
             3.427132e-02, 3.201869e-02, 2.957844e-02, 2.711182e-02, 2.474993e-02, 2.257008e-02, 2.063220e-02, 1.901592e-02,
             1.781627e-02, 1.711101e-02, 1.692784e-02, 1.722276e-02, 1.786736e-02, 1.864803e-02, 1.928773e-02, 1.949956e-02,
             1.906176e-02, 1.787640e-02, 1.600798e-02, 1.366311e-02, 1.111544e-02, 8.634517e-03, 6.425014e-03, 4.598872e-03,
             3.181565e-03, 2.138032e-03, 1.402530e-03, 9.022947e-04, 5.716968e-04, 3.581350e-04, 2.226195e-04, 1.377962e-04,
             8.522737e-05, 5.285354e-05, 3.296921e-05, 2.074185e-05, 1.318567e-05, 8.476808e-06, 5.509668e-06, 3.616271e-06,
             2.392409e-06, 1.591868e-06, 1.062969e-06, 7.108766e-07, 4.752905e-07, 3.172282e-07, 2.111062e-07, 1.399296e-07,
             9.230636e-08, 6.055587e-08, 3.948321e-08, 2.557175e-08, 1.644318e-08, 1.049290e-08, 6.642265e-09, 4.169587e-09,
             2.594705e-09, 1.600218e-09, 9.778210e-10, 5.918816e-10, 3.548329e-10, 2.106470e-10, 1.238134e-10, 7.204549e-11,
             4.149790e-11, 2.365835e-11, 1.334891e-11, 7.453799e-12, 4.118621e-12, 2.251865e-12, 1.218220e-12, 6.520498e-13,
             3.452926e-13, 1.808951e-13, 9.375237e-14, 4.806589e-14, 2.437673e-14, 1.222877e-14, 6.067993e-15, 2.978160e-15,
             1.445698e-15, 6.941034e-16, 3.295878e-16, 1.547783e-16, 7.188469e-17, 3.301456e-17, 1.499410e-17, 6.733607e-18]

data['Up_2017'] = [ 6.280936e-06, 2.269786e-05, 3.992994e-05, 9.215916e-05, 8.583266e-05, 1.300168e-04, 1.507808e-04, 1.525301e-04,
                    1.836871e-04, 3.608491e-04, 7.838211e-04, 1.453753e-03, 2.501254e-03, 3.646955e-03, 5.121242e-03, 7.124435e-03,
                    9.868738e-03, 1.340220e-02, 1.727946e-02, 2.103099e-02, 2.449300e-02, 2.752667e-02, 2.998433e-02, 3.188966e-02,
                    3.338626e-02, 3.467299e-02, 3.588427e-02, 3.693168e-02, 3.762158e-02, 3.781603e-02, 3.746297e-02, 3.659901e-02,
                    3.531524e-02, 3.368600e-02, 3.175666e-02, 2.960036e-02, 2.734127e-02, 2.511070e-02, 2.300023e-02, 2.106449e-02,
                    1.935602e-02, 1.794625e-02, 1.691466e-02, 1.632173e-02, 1.618505e-02, 1.646367e-02, 1.704879e-02, 1.776328e-02,
                    1.837751e-02, 1.864888e-02, 1.837880e-02, 1.746200e-02, 1.591719e-02, 1.389032e-02, 1.159890e-02, 9.277107e-03,
                    7.123823e-03, 5.269356e-03, 3.769333e-03, 2.618800e-03, 1.774895e-03, 1.178461e-03, 7.695630e-04, 4.960539e-04,
                    3.166734e-04, 2.008415e-04, 1.269350e-04, 8.018894e-05, 5.078656e-05, 3.233668e-05, 2.074826e-05, 1.343831e-05,
                    8.793221e-06, 5.812439e-06, 3.877803e-06, 2.607213e-06, 1.763312e-06, 1.197297e-06, 8.146895e-07, 5.546044e-07,
                    3.771917e-07, 2.559858e-07, 1.731885e-07, 1.167124e-07, 7.829040e-08, 5.224370e-08, 3.466287e-08, 2.285577e-08,
                    1.497077e-08, 9.737407e-09, 6.286997e-09, 4.028183e-09, 2.560476e-09, 1.614249e-09, 1.009169e-09, 6.254865e-10,
                    3.842899e-10, 2.340039e-10, 1.412064e-10, 8.443140e-11, 5.001827e-11, 2.935559e-11, 1.706699e-11, 9.828735e-12,
                    5.606426e-12, 3.167368e-12, 1.772202e-12, 9.819975e-13, 5.388546e-13, 2.928060e-13, 1.575504e-13, 8.394118e-14,
                    4.428256e-14, 2.313015e-14, 1.196189e-14, 6.124688e-15, 3.104696e-15, 1.558094e-15, 7.740954e-16, 3.807272e-16]

data['Down_2017'] = [7.108633e-06, 2.813068e-05, 6.537098e-05, 8.689585e-05, 1.171137e-04, 1.605116e-04, 1.633178e-04, 1.877097e-04,
                     3.394077e-04, 8.164405e-04, 1.611132e-03, 2.873246e-03, 4.295664e-03, 6.212990e-03, 8.907709e-03, 1.265429e-02,
                     1.720405e-02, 2.180121e-02, 2.606473e-02, 2.980971e-02, 3.281584e-02, 3.509456e-02, 3.685377e-02, 3.837746e-02,
                     3.979116e-02, 4.089648e-02, 4.143600e-02, 4.127304e-02, 4.041020e-02, 3.896234e-02, 3.704617e-02, 3.473163e-02,
                     3.212495e-02, 2.940720e-02, 2.675891e-02, 2.429493e-02, 2.208877e-02, 2.022876e-02, 1.882763e-02, 1.798521e-02,
                     1.774329e-02, 1.805530e-02, 1.876860e-02, 1.962333e-02, 2.028264e-02, 2.040624e-02, 1.974921e-02, 1.823318e-02,
                     1.598830e-02, 1.329743e-02, 1.049760e-02, 7.888065e-03, 5.665729e-03, 3.910246e-03, 2.607838e-03, 1.690352e-03,
                     1.070707e-03, 6.661073e-04, 4.088636e-04, 2.486595e-04, 1.504467e-04, 9.091843e-05, 5.509667e-05, 3.360470e-05,
                     2.069208e-05, 1.288934e-05, 8.128728e-06, 5.187515e-06, 3.344689e-06, 2.173845e-06, 1.420616e-06, 9.311579e-07,
                     6.108080e-07, 4.002243e-07, 2.615455e-07, 1.702505e-07, 1.102747e-07, 7.101202e-08, 4.542890e-08, 2.885311e-08,
                     1.818280e-08, 1.136347e-08, 7.039499e-09, 4.320890e-09, 2.626919e-09, 1.581330e-09, 9.422775e-10, 5.556606e-10,
                     3.242077e-10, 1.871288e-10, 1.068301e-10, 6.031461e-11, 3.367259e-11, 1.858706e-11, 1.014345e-11, 5.472265e-12,
                     2.918257e-12, 1.538251e-12, 8.014058e-13, 4.126446e-13, 2.099794e-13, 1.055927e-13, 5.247208e-14, 2.576573e-14,
                     1.250140e-14, 5.993233e-15, 2.838788e-15, 1.328495e-15, 6.142292e-16, 2.805567e-16, 1.265997e-16, 5.643287e-17,
                     2.484965e-17, 1.080725e-17, 4.647236e-18, 1.969843e-18, 8.242058e-19, 3.438457e-19, 1.391365e-19, 5.608785e-20]

mc['2018'] = [4.695341e-10, 1.206213e-06, 1.162593e-06, 6.118058e-06, 1.626767e-05, 3.508135e-05, 7.12608e-05,  0.0001400641,
           0.0002663403, 0.0004867473, 0.0008469, 0.001394142, 0.002169081, 0.003198514, 0.004491138, 0.006036423,
           0.007806509, 0.00976048, 0.0118498, 0.01402411, 0.01623639, 0.01844593, 0.02061956, 0.02273221,
           0.02476554, 0.02670494, 0.02853662, 0.03024538, 0.03181323, 0.03321895, 0.03443884, 0.035448,
           0.03622242, 0.03674106, 0.0369877, 0.03695224, 0.03663157, 0.03602986, 0.03515857, 0.03403612,
           0.0326868, 0.03113936, 0.02942582, 0.02757999, 0.02563551, 0.02362497, 0.02158003, 0.01953143,
           0.01750863, 0.01553934, 0.01364905, 0.01186035, 0.01019246, 0.008660705, 0.007275915, 0.006043917,
           0.004965276, 0.004035611, 0.003246373, 0.002585932,0.002040746, 0.001596402, 0.001238498, 0.0009533139,
           0.0007282885, 0.000552306, 0.0004158005, 0.0003107302, 0.0002304612, 0.0001696012, 0.0001238161, 8.96531e-05,
           6.438087e-05, 4.585302e-05, 3.23949e-05,2.271048e-05, 1.580622e-05, 1.09286e-05, 7.512748e-06, 5.140304e-06,
           3.505254e-06, 2.386437e-06, 1.625859e-06, 1.111865e-06, 7.663272e-07,5.350694e-07, 3.808318e-07, 2.781785e-07,
           2.098661e-07, 1.642811e-07,1.312835e-07, 1.081326e-07, 9.141993e-08, 7.890983e-08, 6.91468e-08,6.119019e-08,
           5.443693e-08, 4.85036e-08, 4.31486e-08, 3.822112e-08, 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 ,
           0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 , 0.0 ,]

data['2018'] = [4.857952e-06, 1.705287e-05, 5.203413e-05, 1.136752e-04, 2.002126e-04, 3.106905e-04, 4.579615e-04, 6.662661e-04,
             9.419852e-04, 1.304785e-03, 1.817582e-03, 2.543718e-03, 3.536624e-03, 4.836934e-03, 6.479588e-03, 8.499125e-03,
             1.091434e-02, 1.370439e-02, 1.678807e-02, 2.001629e-02, 2.318735e-02, 2.609085e-02, 2.856827e-02, 3.056144e-02,
             3.211736e-02, 3.334816e-02, 3.437966e-02, 3.531335e-02, 3.620764e-02, 3.707663e-02, 3.789819e-02, 3.862730e-02,
             3.920914e-02, 3.958677e-02, 3.970240e-02, 3.949747e-02, 3.891383e-02, 3.790023e-02, 3.642255e-02, 3.447446e-02,
             3.208496e-02, 2.932003e-02, 2.627793e-02, 2.307904e-02, 1.985237e-02, 1.672182e-02, 1.379378e-02, 1.114828e-02,
             8.834996e-03, 6.873349e-03, 5.256634e-03, 3.958565e-03, 2.940632e-03, 2.158863e-03, 1.569172e-03, 1.131051e-03,
             8.095429e-04, 5.758975e-04, 4.073801e-04, 2.865517e-04, 2.003426e-04, 1.391215e-04, 9.586692e-05, 6.549065e-05,
             4.431358e-05, 2.967699e-05, 1.966063e-05, 1.288066e-05, 8.344654e-06, 5.346382e-06, 3.388533e-06, 2.125329e-06,
             1.319727e-06, 8.116338e-07, 4.945375e-07, 2.986064e-07, 1.786892e-07, 1.059669e-07, 6.226244e-08, 3.623437e-08,
             2.087677e-08, 1.190231e-08, 6.710919e-09, 3.739941e-09, 2.058878e-09, 1.119023e-09, 6.001559e-10, 3.174652e-10,
             1.655557e-10, 8.508168e-11, 4.307423e-11, 2.147592e-11, 1.054187e-11, 5.093417e-12, 2.421767e-12, 1.132936e-12,
             5.213823e-13, 2.360057e-13, 1.050627e-13, 4.599248e-14, 1.979678e-14, 8.377884e-15, 3.485573e-15, 1.425553e-15,
             5.731116e-16, 2.264752e-16, 8.796199e-17, 3.357735e-17, 1.259770e-17, 4.644727e-18, 1.683580e-18, 5.990986e-19,
             2.092040e-19, 7.182307e-20, 2.402734e-20, 8.295504e-21, 2.476434e-21, 7.085869e-22, 0.000000e+00, 0.000000e+00]

data['Up_2018'] = [4.506734e-06, 1.494502e-05, 4.463410e-05, 9.798030e-05, 1.729579e-04, 2.692835e-04, 3.921619e-04, 5.638664e-04,
                   7.941274e-04, 1.088646e-03, 1.488619e-03, 2.051124e-03, 2.824123e-03, 3.847849e-03, 5.152452e-03, 6.767602e-03,
                   8.719954e-03, 1.101782e-02, 1.363265e-02, 1.648482e-02, 1.944086e-02, 2.232839e-02, 2.497240e-02, 2.724205e-02,
                   2.908764e-02, 3.054471e-02, 3.170413e-02, 3.267224e-02, 3.353954e-02, 3.436375e-02, 3.516627e-02, 3.593715e-02,
                   3.664403e-02, 3.724336e-02, 3.768783e-02, 3.792960e-02, 3.792006e-02, 3.761012e-02, 3.695231e-02, 3.590745e-02,
                   3.445262e-02, 3.258918e-02, 3.034749e-02, 2.778726e-02, 2.499318e-02, 2.206683e-02, 1.911616e-02, 1.624504e-02,
                   1.354372e-02, 1.108177e-02, 8.904694e-03, 7.033534e-03, 5.467446e-03, 4.188454e-03, 3.167006e-03, 2.367415e-03,
                   1.752378e-03, 1.286357e-03, 9.376562e-04, 6.793852e-04, 4.896201e-04, 3.510626e-04, 2.504017e-04, 1.775910e-04,
                   1.251519e-04, 8.756522e-05, 6.077701e-05, 4.181429e-05, 2.849775e-05, 1.923073e-05, 1.284585e-05, 8.493306e-06,
                   5.558718e-06, 3.602071e-06, 2.311777e-06, 1.469983e-06, 9.264196e-07, 5.788554e-07, 3.586761e-07, 2.204252e-07,
                   1.343539e-07, 8.121191e-08, 4.867082e-08, 2.891033e-08, 1.701355e-08, 9.915008e-09, 5.719160e-09, 3.263571e-09,
                   1.841444e-09, 1.026882e-09, 5.656943e-10, 3.077234e-10, 1.652303e-10, 8.754227e-11, 4.575190e-11, 2.357991e-11,
                   1.198143e-11, 6.000857e-12, 2.961905e-12, 1.440482e-12, 6.901724e-13, 3.257336e-13, 1.514160e-13, 6.931708e-14,
                   3.124846e-14, 1.387080e-14, 6.062170e-15, 2.608449e-15, 1.104934e-15, 4.607588e-16, 1.891361e-16, 7.642026e-17,
                   3.039246e-17, 1.189695e-17, 4.584722e-18, 1.738413e-18, 6.484060e-19, 2.368231e-19, 8.660590e-20, 3.090482e-20]

data['Down_2018'] = [5.266401e-06, 1.965368e-05, 6.105488e-05, 1.326606e-04, 2.331268e-04, 3.617259e-04, 5.411566e-04, 7.950172e-04,
                     1.129566e-03, 1.590780e-03, 2.259940e-03, 3.207097e-03, 4.489148e-03, 6.149326e-03, 8.230376e-03, 1.076367e-02,
                     1.373973e-02, 1.707850e-02, 2.061452e-02, 2.411123e-02, 2.731398e-02, 3.002901e-02, 3.218788e-02, 3.385293e-02,
                     3.516316e-02, 3.626759e-02, 3.727888e-02, 3.825351e-02, 3.919420e-02, 4.006275e-02, 4.079882e-02, 4.133446e-02,
                     4.160052e-02, 4.152666e-02, 4.104209e-02, 4.008078e-02, 3.859392e-02, 3.656401e-02, 3.401648e-02, 3.102366e-02,
                     2.769979e-02, 2.418857e-02, 2.064542e-02, 1.721930e-02, 1.403646e-02, 1.118913e-02, 8.730968e-03, 6.678075e-03,
                     5.015368e-03, 3.705667e-03, 2.699352e-03, 1.942700e-03, 1.384106e-03, 9.779036e-04, 6.860341e-04, 4.782368e-04,
                     3.313357e-04, 2.280719e-04, 1.558561e-04, 1.056287e-04, 7.091952e-05, 4.712184e-05, 3.095820e-05, 2.009827e-05,
                     1.288914e-05, 8.164722e-06, 5.109538e-06, 3.160036e-06, 1.932264e-06, 1.168729e-06, 6.995618e-07, 4.145262e-07,
                     2.432071e-07, 1.412891e-07, 8.126085e-08, 4.625448e-08, 2.604508e-08, 1.449945e-08, 7.975491e-09, 4.331678e-09,
                     2.321454e-09, 1.226847e-09, 6.389773e-10, 3.277952e-10, 1.655472e-10, 8.227085e-11, 4.021605e-11, 1.932979e-11,
                     9.132573e-12, 4.240124e-12, 1.934103e-12, 8.665746e-13, 3.813107e-13, 1.647519e-13, 6.988765e-14, 2.910299e-14,
                     1.189587e-14, 4.772395e-15, 1.878992e-15, 7.259924e-16, 2.752474e-16, 1.023975e-16, 3.737642e-17, 1.338458e-17,
                     4.704499e-18, 1.621870e-18, 5.462542e-19, 1.823498e-19, 5.821017e-20, 1.894645e-20, 5.657920e-21, 2.299010e-21,
                     0.000000e+00, 0.000000e+00, 0.000000e+00, 0.000000e+00, 0.000000e+00, 0.000000e+00, 0.000000e+00, 0.000000e+00]

import numpy as np
from numpy import inf, nan
from coffea.lookup_tools import dense_lookup
from coffea.util import save
for year in ['2017', '2018']:
    print(len(data[year]))
    print(len(mc[year]))
    weight = np.array(data[year])/np.array(mc[year])
    weight[weight==inf] = 0
    weight = np.nan_to_num(weight)
    arr = np.array(range(120))
    lookup = dense_lookup.dense_lookup(weight, arr)
    save(lookup, f"puLookup_{year}.coffea")
    for var in ['Up', 'Down']:
        weight = np.array(data[f'{var}_{year}'])/np.array(mc[year])
        weight[weight==inf] = 0
        weight = np.nan_to_num(weight)
        arr = np.array(range(120))
        lookup = dense_lookup.dense_lookup(weight, arr)
        save(lookup, f"puLookup_{var}_{year}.coffea")
